title
Topic Modeling based Sentiment Analysis on Social Media for Stock Market Prediction

abstract
The goal of this research is to build a model to predict stock price movement using sentiments on social media. A new feature which captures topics and their sentiments simultaneously is introduced in the prediction model. In addition, a new topic model TSLDA is proposed to obtain this feature. Our method outperformed a model using only historical prices by about 6.07% in accuracy. Furthermore, when comparing to other sentiment analysis methods, the accuracy of our method was also better than LDA and JST based methods by 6.43% and 6.07%. The results show that incorporation of the sentiment information from social media can help to improve the stock prediction.

Introduction Stock price forecasting is very important in the planning of business activity. However, building an accurate stock prediction model is still a challenging problem. In addition to historical prices, the current stock market is affected by the mood of society. The overall social mood with respect to a given company might be one of the important variables which affect the stock price of that company. Nowadays, the emergence of online social networks makes large amounts of mood data available. Therefore, incorporating information from social media with the historical prices can improve the predictive ability of the models. The goal of our research is to develop a model to predict a stock price movement using information from social media (Message Board). In our proposed method, the model predicts the movement of the stock value at t using features derived from information at t ? 1 and t ? 2, where t stands for a transaction date. It will be trained by supervised machine learning. Apart from the mood information, the stock prices are affected by many factors such as microeconomic and macroeconomic factors. However, this research only focuses on how the mood information from social media can be used to predict the stock price movement. That is, the mood of topics in social media is extracted by sentiment analysis. Then, the topics and their sentiments are integrated into the model to predict the stocks. To achieve this goal, discovering the topics and sentiments in a large amount of social media is important to get opinions of investors as well as events of companies. However, sentiment analysis on social media is difficult. The text is usually short, contains many misspellings, uncommon grammar constructions and so on. In addition, the literature shows conflicting results in sentiment analysis for stock market prediction. Some researchers report that the sentiments from social media have no predictive capabilities  (Antweiler and Frank, 2004; Tumarkin and Whitelaw, 2001) , while other researchers have reported either weak or strong predictive capabilities  (Bollen et al., 2011) . Therefore, how to use opinions in social media for stock price predictions is still an open problem. Our contributions are summarized as follows: 1. We propose a new feature "topic-sentiment" for the stock market prediction model. 2. We propose a new topic model, Topic Sentiment Latent Dirichlet Allocation (TSLDA), which can capture the topic and sentiment simultaneously. 3. Large scale evaluation. Most of the previous researches are limited on predicting for one stock  (Bollen et al., 2011; Qian and Rasheed, 2007; Si et al., 2013) , and the number of instances (transaction dates) in a test set is rather low such as 14 or 15 instances  (Bollen et al., 2011; Vu et al., 2012) . With only a few instances in the test set, the conclusion might be insufficient. This is the first research that shows good prediction results on evaluation of many stocks using a test set consisting of many transaction dates. The rest of the paper is organized as follows. Section 2 introduces some previous approaches on sentiment analysis for stock prediction. Section 3 explains our model for sentiment analysis by simultaneously inferring the topic and sentiment in the text. Section 4 describes two kinds of datasets required for stock prediction. Section 5 describes our prediction models and also proposes a novel feature based on the topics and sentiments. Section 6 assesses the results of the experiments. Finally, Section 7 concludes our research. 

 Related Work Stock market prediction is one of the most attracted topics in academic as well as real life business. Many researches have tried to address the question whether the stock market can be predicted. Some of the researches were based on the random walk theory and the Efficient Market Hypothesis (EMH). According to the EMH  (Fama et al., 1969; Fama, 1991) , the current stock market fully reflects all available information. Hence, price changes are merely due to new information or news. Because news in nature happens randomly and is unknowable in the present, stock prices should follow a random walk pattern and the best bet for the next price is the current price. Therefore, they are not predictable with more than about 50% accuracy  (Walczak, 2001) . On the other hand, various researches specify that the stock market prices do not follow a random walk, and can be predicted in some degree  (Bollen et al., 2011; Qian and Rasheed, 2007; Vu et al., 2012) . Degrees of accuracy at 56% hit rate in the predictions are often reported as satisfying results for stock predictions  (Schumaker and Chen, 2009b; Si et al., 2013; Tsibouris and Zeidenberg, 1995) . Besides the efficient market hypothesis and the random walk theories, there are two distinct trading philosophies for stock market prediction: fundamental analysis and technical analysis. The fundamental analysis studies the company's financial conditions, operations, macroeconomic indicators to predict the stock price. On the other hand, the technical analysis depends on historical and time-series prices. Price moves in trends, and history tends to repeat itself. Some researches have tried to use only historical prices to predict the stock price  (Zuo and Kita, 2012a; Zuo and Kita, 2012b) . To discover the pattern in the data, they used Bayesian network  (Zuo and Kita, 2012a; Zuo and Kita, 2012b) , time-series method such as Auto Regressive, Moving Average, Auto Regressive Moving Average model  (Zuo and Kita, 2012a ) and so on. 

 Extracting Opinions from Text Sentiment analysis has been found to play a significant role in many applications such as product and restaurant reviews  (Liu and Zhang, 2012; Pang and Lee, 2008) . There are some researches trying to apply sentiment analysis on information sources to improve the stock prediction model. There are two main such sources. In the past, the main source was the news  (Schumaker and Chen, 2009a; Schumaker and Chen, 2009b) , and in recent years, social media sources. A simple approach is combining the sentiments in the textual content with the historical prices through the linear regression model. Most of the previous work primarily used the bag-of-words as text representation that are incorporated into the prediction model. Schumaker and Chen tried to use different textual representations such as bag-of-words, noun phrases and named entities for financial news  (Schumaker and Chen, 2009b) . However, the textual representations are just the words or named entity tags, not exploiting the mood information so much. A novel tree representation based on semantic frame parsers is proposed  (Xie et al., 2013) . By using stock prices from Yahoo Finance, they annotated all the news in a transaction date with going up or down categories. However, the weakness of this assumption is that all the news in one day will have the same category. In addition, this is a task of text classification, not stock prediction. Naive Bayes was used to classify messages from message boards into three classes: buy, hold and sell  (Antweiler and Frank, 2004) . They were integrated into the regression model. However, they concluded that their model does not successfully predict stock returns. A method to measure collective hope and fear on each day and analyze the correlation between these indices and the stock market indicators was proposed  (Zhang et al., 2011) . They used the mood words to tag each tweet as fear, worry, hope and so on. They concluded that the ratio of the emotional tweets significantly negatively correlated with Down Jones, NASDAQ and S&P 500, but positively with VIX. However, they did not use their model to predict the stock price values. Two mood tracking tools, OpinionFinder and Google Profile of Mood States, were used to analyze the text content of daily Twitter  (Bollen et al., 2011) . The former measures the positive and negative mood. The latter measures the mood in terms of six dimensions (Calm, Alert, Sure, Vital, Kind, and Happy). They used the Self Organizing Fuzzy Neural Network model to predict DJIA values. The results showed 86.7% direction accuracy (up or down) and 1.79% Mean Absolute Percentage Error. Although they achieved the high accuracy, there were only 15 transaction dates (from December 1 to  19, 2008)  in their test set. With such a short period, it might not be sufficient to conclude the effectiveness of their method. A keyword-based algorithm was proposed to identify the sentiment of tweets as positive, neutral and negative for stock prediction  (Vu et al., 2012) . Their model achieved around 75% accuracy. However, their test period was short, from 8 th to 26 th in September 2012, containing only 14 transaction dates. Continuous Dirichlet Process Mixture (cDPM) model was used to learn the daily topic set of Twitter messages to predict the stock market  (Si et al., 2013) . A sentiment time series was built based on these topics. However, the time period of their whole dataset is rather short, only three months. Most of the researches tried to extract only the opinions or sentiments. However, one important missing thing is that opinions or sentiments are expressed on topics or aspects of companies. Therefore, understanding on which topics of a given stock people are expressing their opinion is very important. Although the models for inferring the topics and sentiments simultaneously have already proposed as discussed in Subsection 2.2, to the best of our knowledge, such models have never applied for stock market prediction. 

 Aspect based Sentiment Analysis Some researches tried to identify the sentiment expressed toward an aspect in a sentence rather than a whole sentence or document. The simple ap-proach is to define a sentiment score of a given aspect by the weighted sum of opinion scores of all words in the sentence, where the weight is defined by the distance from the aspect  (Liu and Zhang, 2012; Pang and Lee, 2008) . This method is further improved by identifying the aspect-opinion relations using tree kernel method  (Nguyen and Shirai, 2015) . Other researches trying to extract both the topic and sentiment for some domains such as online product, restaurant and movie review dataset. ASUM is a model for extracting both the aspect and sentiment for online product review dataset  (Jo and Oh, 2011) . Joint sentiment/topic model (JST) is another model to detect the sentiment and topic simultaneously, which was applied for movie review dataset  (Lin and He, 2009) . These models assume that each word is generated from a joint topic and sentiment distribution. It means that these models do not distinguish the topic word and opinion word distributions. Besides the general opinion words, topic models considering aspect-specific opinion words were also proposed. MaxEnt-LDA hybrid model can jointly discover both aspects and aspectspecific opinion words on a restaurant review dataset  (Zhao et al., 2010) , while FACTS, CFACTS, FACTS-R, and CFACTS-R model were proposed for sentiment analysis on a product review data  (Lakkaraju et al., 2011) . However, one of the weaknesses of these methods is that there is only one opinion word distribution corresponding to one topic (aspect). It makes difficult to know which sentiment (e.g. positive or negative) is expressed by the opinion words on that topic. To overcome this drawback, we propose a new topic model called Topic Sentiment Latent Dirichlet Allocation (TSLDA), which estimates different opinion word distributions for individual sentiment categories for each topic. To the best of our knowledge, such a model has not been proposed. TSLDA is suitable for not only sentiment analysis for stock prediction but also general sentiment analysis of the document, sentence and aspect. 

 TSLDA: Topic Sentiment Latent Dirichlet Allocation The proposed model TSLDA infers the topics and their sentiments simultaneously. It is an extended model of Latent Dirichlet Allocation (LDA)  (Blei et al., 2003) . We assume that one sentence ex- For example, the opinion word "low" in "low cost" and "low salary" have opposite polarity. In our model, different topics, which are also represented by word distributions, will have different opinion word distributions. Finally, to capture the sentiment meanings such as positive, negative or neutral of the opinion words for each topic, we distinguish opinion word distributions for different sentiment meanings. Figure  1  shows the graphical model representation of TSLDA. Observed and hidden variables are indicated by shaded and clear circles, respectively. Table  1  shows the notations in Figure  1 . The generation process in TSLDA is as follows: 1. Choose a distribution of background words ? b ? Dirichlet(?) 2. For each topic k: ? Choose a distribution of topic words  ? t k ? Dirichlet(?) ? For each sentiment s of topic k: -Choose a distribution of sentiment words ? o k,s ? Dirichlet(?) w d,m,n ? ? ? ? ? ? M ultinomial(? b ) if c d,m,n = 0 M ultinomial(? t z t d,m ) if c d,m,n = 1 M ultinomial(? o z t d,m ,z o d,m ) if c d,m,n = 2 (1) We will define some notations for explanation of our method. W k,s d,m,v,c is the number of times the word v with the category c appears in the sentence m in the document d, where m discusses the topic k and the sentiment s. Let Z k,s d be the number of times the document d has the topic k and the sentiment s. If any of these dimensions is not limited to a specific value, we used an asterisk * to denote it. For example, W k,s * , * ,v,c is the number of appearance of combination (v, c, k, s) in any sentences in any documents. Similarly, Z k, * d is the number of times the document d has the topic k with any sentiments. A bold-font variable denotes the list of the variables. For instance, z t and w denote all of topic assignments and words in all documents, respectively. ?(d, m) stands for exclusion of the value in the sentence m in the document d. For example, z t ?(d,m) denotes all of topic assignment variables z t but z t d,m . Z a, * ?(d,m) d denotes the value of Z a, * d not counting times at the sentence m in the document d. We used square brackets for specifying the value at the index of a vector or distribution. For instance, ?[v] denotes the value of ? at index v. Collapsed Gibbs Sampling was implemented for inference in TSLDA. It will sequentially sample hidden variables z t d,m and z o d,m from the distribution over these variables given the current values of all other hidden and observed variables. In other words, in order to perform Collapsed Gibbs Sampling, conditional probability P (z t d,m = a, z o d,m = b|z t ?(d,m) , z o ?(d,m) , w, c ) is calculated by marginalizing out random variables ? b , ? t , ? o , ? t and ? o . Because of the limit of spaces, we only show the final formula of this conditional probability as in Equation (2). Let V d,m be a set of words in the sentence m in the document d. V is a set of all of the words in all documents. P (z t d,m = a, z o d,m = b|z t ?(d,m) , z o ?(d,m) , w, c, ) ? (Z a, * ?(d,m) d + ?[a])(Z * ,b?(d,m) d + ?[b]) ? V d,m v=1 W * , * d,m,v,1 j=1 (W a, * ?(d,m) * , * ,v,1 + ?[v] + j ? 1) W * , * d,m, * ,1 j=1 ( V v=1 W a, * ?(d,m) * , * ,v,1 + ?[v] + j ? 1) ? V d,m v=1 W * , * d,m,v,2 j=1 (W a,b?(d,m) * , * ,v,2 + ?[v] + j ? 1) W * , * d,m, * ,2 j=1 ( V v=1 W a,b?(d,m) * , * ,v,2 + ?[v] + j ? 1) (2) Multinomial parameters: Finally, samples obtained from Collapsed Gibbs Sampling can be used to approximate the multinomial parameter sets. The distributions of topics and sentiments in the document d are estimated as in Equation (3). ? t d [a] = Z a, * d + ?[a] K k=1 Z k, * d + ?[k] ; ? o d [b] = Z * ,b d + ?[b] S s=1 Z * ,s d + ?[s] (3) The background word distribution, topic word distribution of the topic k and sentiment word distribution of the sentiment s for k are estimated in Equation (  4 ), (  5 ) and (  6 ), respectively. ? b [r] = W * , * * , * ,r,0 + ?[r] V v=1 W * , * * , * ,v,0 + ?[v] (4) ? t k [r] = W k, * * , * ,v,1 + ?[r] V v=1 W k, * * , * ,v,1 + ?[v] (5) ? o k,s [r] = W k,s * , * ,v,2 + ?[r] V v=1 W k,s * , * ,v,2 + ?[v] (6) 

 Dataset Two datasets are used for the development of our stock prediction model. One is the historical price dataset, and the other is the message board dataset. 

 Historical Price Dataset Historical prices are extracted from Yahoo Finance for 5 stocks. The list of the stock quotes and company names is shown in Table  2 . For each transaction date, there are open, high, low, close and adjusted close prices. The adjusted close prices are the close prices which are adjusted for dividends and splits. They are often used for stock market prediction as in other researches  (Rechenthin et al., 2013) . Therefore, we chose it as the stock price value for each transaction date. 

 Message Board Dataset To get the mood information of the stocks, we collected 5 message boards of the 5 stocks from Yahoo Finance Message Board for a period of one year (from July 23, 2012 to July 19, 2013). On the message boards, users usually discuss company news, prediction about stock going up or down, facts, comments (usually negative) about specific company executives or company events. The stock market is not opened at the weekend and holiday. To assign the messages to the transaction dates, the messages which were posted from 4 pm of the previous transaction date to 4 pm of the current transaction date will belong to the current transaction. We choose 4 pm because it is the time of closing transaction. There are 249 transaction dates in the one year period in our dataset. 

 Stock Prediction Models with Sentiment Analysis This paper focuses on prediction of not the stock price but movement of it. That is, our goal is to develop a model that predicts if the stock price goes up or down. Support Vector Machine (SVM) has long been recognized as being able to efficiently handle high dimensional data and has been shown to perform well on many tasks such as text classification  (Joachims, 1998; Nguyen and Shirai, 2013) . Therefore, we chose SVM with the linear kernel as the prediction model. Furthermore, features derived by sentiment analysis on the message board are incorporated in it. To assess the effectiveness of sentiment analysis, four sets of features are designed. The first one uses only the historical prices. The other sets include topic and sentiment features obtained by different methods. All the feature values are scaled into [?1, 1] value. Table 3 summarizes our features used in the model to predict the price movement at the transaction date t. The details of each feature will be explained in the next subsections. 

 Price Only In this method, only historical prices are used to predict the stock movement. The purpose of this method is to investigate whether there are patterns of the price movement in the history of the stock. In addition, it is a baseline for evaluation of the  

 LDA-based Method In this model, we consider each message as a mixture of hidden topics. LDA is a generative probabilistic model of a corpus 1 . The basic idea is that documents are represented as random mixtures over latent topics, where each topic is characterized by a distribution over words. Hidden topics of LDA are incorporated into the prediction model as follows. First, stop words are removed from the messages, and all the words are lemmatized by Stanford CoreNLP  (Manning et al., 2014) . Topics are inferred by Gibbs Sampling with 1000 iterations. Next, the probability of each topic for each message is calculated. For each transaction date t, the probability of each topic is defined as the average of the probabilities of the topic in all messages posted on that transaction date. Features used for training SVM are price t?1 , price t?2 , lda i,t and lda i,t?1 . lda i,t and lda i,t?1 are the probabilities of the topic i (i ? {1, ? ? ? , K}) for the transaction dates t and t ? 1. The number of the topics K is empirically determined as explained in Subsection 6.1. 

 JST-based Method When people post the message on social media to express their opinion for a given stock, they tend to talk their opinions for a given topic or aspect such as profit and dividend. They would think that the future price of the stock goes up or down by seeing pairs of topic-sentiment written by others. Following the above intuition, we propose a new feature topic-sentiment for the stock predic- One is a latent topic based model called JST  (Lin and He, 2009) . The other is TSLDA discussed in Section 3. This subsection introduces the method using the former. We consider each message as a mixture of hidden topics and sentiments. JST model is used to extract topics and sentiments simultaneously.   4 . In LDA model, there is only one document specific topic distribution. In contrast, each document in JST is associated with multiple sentiment labels. Each sentiment label is associated with a document specific topic distribution. A word in the document is drawn from a distribution over words defined by the topic and sentiment label. After removal of stop words and lemmatization, JST model is trained by Gibbs Sampling with 1000 iterations. We chose 3 as the number of sentiments which might represent negative, neu-tral and positive. The number of the topics K is empirically determined as explained in Subsection 6.1. Next, the joint probability of each pair of topic and sentiment is calculated for each message. For each transaction date t, the joint probability of each topic-sentiment pair is defined as the average of the joint probabilities in the messages on that transaction date. Then we integrate these probabilities into the prediction model. Features used for training SVM are price t?1 , price t?2 , jst i,j,t and jst i,j,t?1 . jst i,j,t and jst i,j,t?1 are the joint probabilities of the sentiment i (i ? {1, 2, 3}) and topic j (j ? {1, ? ? ? , K}) for the transaction dates t and t ? 1. 

 TSLDA-based Method We use our TSLDA model to capture the topics and sentiments simultaneously. First, a rule-based algorithm is applied to identify the category of each word in the documents. Consecutive nouns are considered as topic words. If a word is not a noun and in a list of opinion words in SentiWord-Net  (Baccianella et al., 2010) , it is considered as an opinion word. The rest of words are classified as background words. After lemmatization, TSLDA model is trained by Collapsed Gibbs Sampling with 1000 iterations. We chose 3 as the number of sentiments which might represent for negative, neutral and positive. K (number of topics) is determined as explained in Subsection 6.1. The topic and its sentiment in each sentence are gotten from the topic assignment and sentiment assignment in TSLDA. If there is a sentence expressing the sentiment j on the topic i, we represent the tuple (i, j) = 1, and 0 otherwise. The proportion of (i, j) over all sentences are calculated for each message. For each transaction date, a weight of the tuple (i, j) is defined as the average of the proportions over all messages. Then we integrated the weights of the topics and their sentiments into the prediction model. Features used for training SVM are price t?1 , price t?2 , tslda i,j,t and tslda i,j,t?1 . tslda i,j,t and tslda i,j,t?1 are the weights of the topic i (i ? {1, ? ? ? , K}) with the sentiment j (j ? {1, 2, 3}) for the transaction dates t and t ? 1. To optimize the number of topics K for each stock, we run the models with four values of K: 10, 20, 50 and 100. The best K is chosen for each stock on the development set, and the systems with the chosen K is evaluated on the test data. The performance of the prediction is measured by accuracy. For the hyperparameters of LDA, JST and TSLDA, we simply selected symmetric Dirichlet prior vectors, that is all possible distributions are likely equal. We used the default values of these hyperparameters for LDA and JST. Concretely speaking, ? = 0.5, ? = 0.01 in LDA and ? = 50 #topics , ? = 0.01, ? = 0.3 were used in JST. For TSLDA, we set ? = 0.1, ? = 0.1, ? = 0.01 and ? = 0.01. 

 Results The result of each stock is shown in Table  5 . In addition, the average of 5 stocks for each model is revealed in the last row of this table for easy comparison. Our model TSLDA-based method outperformed the other methods on the average of the stocks. Table  6  shows the number of true positive (TP), true negative (TN), false positive (FP) and false negative (FN) of models for the stocks. For easy comparison, the summation for these five stocks are calculated in the last row. To assess the effectiveness of integrating mood information, we compare our TSLDA-based method with Price Only method. The results showed that the model using mood information outperformed the model without mood by 3.57%, 3.58%, 14.29% and 12.5% accuracy for XOM, EBAY, IBM and KO stock, respectively. On the other hand, the performance on DELL stock was not improved. It means that the use of the mood does not always make the performance better. The mood from social media could lead to a wrong prediction because of wrong prediction of message writers, fault information and so on. However, TSLDA was better than Price Only method on average of these stocks. In addition, TSLDA can reduce the number of FN, especially for IBM, although FP was not changed in the sum of 5 stocks. Thus, we can conclude that integrating the mood information from social media can help to predict stock price movement more precisely. Next, let us compare the models for inferring latent topics only (LDA) and topics and sentiments (JST and TSLDA) in the stock movement prediction. The accuracy of JST-based method was better than LDA for two stocks (XOM and IBM), worse for three stocks and comparable in the average of five stocks. While, TSLDA-based method outperformed LDA and JST by 2 to 17% in the accuracy for five stocks. TSLDA was also better than LDA and JST on average as shown in Table  5 . The improvement of the accuracy was derived by increase of TP and decrease of FN. These results indicate that (1) our idea to use both latent topics and sentiments as the features is effective, (2) TSLDA is more appropriate model than JST in stock movement prediction. Table  7  shows examples of highly associated words of some topics for stock KO (Coca-Cola Company) in TSLDA. For example, 'split', 'stock' and 'share' are words highly associated with the hidden topic 2, and 'drink', 'coke' and 'water' are highly associated with the topic 3. The first five hidden topics in Table  7  may represent the management, stock market trading, product, customer care service, competitors of the company, while the last one indicates macroeconomic factors. Table  8  shows examples of highly associated words of three sentiments of the hidden topic 1 and 2. For the hidden topic 1, 'growth', 'strong', 'solid' etc. are the words highly associated with the hidden sentiment 3 (which may corresponds to positive class), while 'old', 'tired', 'unreal' etc. with the hidden sentiment 1 (may be negative). In general, however, it is rather difficult to interpret the meaning of the hidden sentiment because the sentiments have many dimensions such as happy, anger, sad, vital and so on. We also found that the words with high probabilities in the background distribution were the stop words, punctuations, function words, messy characters written in social media, e.g.  '.', 'the', 'and', 'you', '$', 'for' and '?'.  Table  9  shows top words in some joint sentiment topic distributions of JST model for stock KO. For example, 'yahoo', 'ko' and 'finance' are highly associated with the distribution defined by hidden sentiment 1 and hidden topic 1. However, it is rather difficult to guess which sentiment or topic in this joint distribution actually means.  

 Conclusion This paper presents the method to infer the topics and their sentiments on the documents and use them for prediction of the stock movement. The results of the experiments show the effectiveness of our proposed TSLDA-based method. Although 56% accuracy of our method is not so high, it can be satisfying results as regarded in the previous papers. Another advantage of the paper is the evaluation by the large scale experiment (five stocks, three month transaction dates in the test set). The drawback of TSLDA is that we have to specify the number of topics and sentiment beforehand. To overcome it, TSLDA should be extended as a non-parametric topic model estimating the number of topics inherent in the data. This will be done in our future work. Figure 1 : 1 Figure 1: Graphical Model Representation of TSLDA 
